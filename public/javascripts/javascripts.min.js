var wordCloud={};wordCloud.communicationModule=function(){function e(e,t){o.onreadystatechange=function(){4==o.readyState&&(200==o.status?e instanceof Function?e(JSON.parse(o.responseText)):console.log("do nothing with the results."):t())},o.open("GET","/topics",!0),o.send()}function t(){alert("An error happend while loading the results.")}var o=new XMLHttpRequest;return{get:e,defaultOnErrorAction:t}}(),wordCloud.Binder=function(){function e(e){this.objectCallbacks={},t=e,o=this,document.addEventListener("change",this.callbackOnChangeEvent.bind(t),!1)}var t=null,o=null;return e.prototype.subscribe=function(e,t){this.objectCallbacks[e]=this.objectCallbacks[e]||[],this.objectCallbacks[e].push(t)},e.prototype.publish=function(e,t,o){for(var n=this.objectCallbacks[t].length,r=0;n>r;r++)this.objectCallbacks[t][r](e,t,o)},e.prototype.callbackOnChangeEvent=function(e){var t=e.target,n=t.getAttribute("data-binding"),r=n.match(/[a-zA-Z0-9]+/g);n&&o.publish(this,r[1],t.value)},e}(),wordCloud.TwoWayBind=function(e){function t(o,n){var r=new e(o);Object.defineProperty(o,n,{get:function(){return o["_"+n]},set:function(e){e instanceof t||(o["_"+n]=e,r.publish(o,n,e))}}),r.subscribe(n,this.ModelToUI),r.subscribe(n,this.UIToModel)}return t.prototype.ModelToUI=function(e,t,o){for(var n=document.querySelectorAll("[data-binding="+e.constructor.name+"-"+t+"]"),r=null,a=0;a<n.length;a++)r=n[a].tagName.toLowerCase(),"input"===r||"textarea"===r||"select"===r?n[a].value=o:n[a].innerHTML=o},t.prototype.UIToModel=function(e,t,o){e["_"+t]=o},t}(wordCloud.Binder),window.onerror=function(e,t,o,n,r){wordCloud.uiHelpersModule.getHTMLElementBasedOnItsId("alert-area");alert(e)},wordCloud.ExceptionHandling=function(){return{}}(),wordCloud.resultTopics=[],console.log("test"),window.onload=function(){wordCloud.communicationModule.get(wordCloud.wordCloudModule.doWordCloudAfterReceivedRespone,wordCloud.communicationModule.defaultOnErrorAction)},wordCloud.mathModule=function(){function e(e,t){return"string"==typeof n?t[n]-e[n]:t-e}function t(t,o){if(!(t instanceof Array))throw new Error("Please provide an array.");if(void 0!==o&&"string"!=typeof o)throw new Error("The property has to be a string");var r=[];return n=o,t.sort(e),r=t.slice(0),t.length=0,r.forEach(function(e,o){o%2?t.push(e):t.unshift(e)}),n=null,t}function o(e){function t(){return Math.random()-Math.random()}for(var o=[],n=20,r=0;n>=r;r++)o[r]=0;for(var r=0;e>r;r++)o[10+Math.round(10*t())]++;return o.slice(5,15)}var n=null;return{normalDistributionSorter:t,generateArrayWithNormalDistributedElements:o,numberSorterDescending:e}}(),wordCloud.uiHelpersModule=function(){function e(e,t,o){if("string"!=typeof e)throw new Error("The type has to be a string.");var n=document.createElement(e);if(n.id=t,o instanceof Array)for(var r=0;r<o.length;r++)n.classList.add(o[r]);else n.classList.add(o);return n}function t(e){return document.getElementById(e)}function o(e){return document.getElementsByClassName(e)}function n(e,t){if(!e||!e.nodeType)throw new Error("Please provide a valid HTML element");if("object"!=typeof t)throw new Error("Please provide valid CSS-styles");for(var o in t)t.hasOwnProperty(o)&&(e.style[o]=t[o])}function r(e,t){if(!(e&&e.nodeType&&t&&t.nodeType))throw new Error("Please provide valid HTML elements");t.appendChild(e)}function a(e,o,n){return!!t(e).style[o]===n}function i(e,o,n){return t(e).style[o]=n}return{createAHTMLElement:e,getHTMLElementBasedOnItsId:t,getHTMLElementsBasedOnTheirClass:o,applyStylingToAHTMLElement:n,addElementToParentElement:r,checkIfAHTMLElementHasASpecificStyle:a,setStyleInAHTMLElement:i}}(),wordCloud.wordCloudModule=function(e,t,o){function n(){return c}function r(t){c=e.normalDistributionSorter(t,"volume")}function a(e){i(t.getHTMLElementBasedOnItsId("word-cloud")),r(e),l(),d()}function i(o){for(var n=null,r=0,a=o.offsetWidth,i=e.generateArrayWithNormalDistributedElements(10*a),l=i.length,d=0;l>d;d++)r=i[d],n=t.createAHTMLElement("div","cloud-row"+d,"cloud-row"),r=r/o.offsetWidth*100,t.applyStylingToAHTMLElement(n,{width:r+"%",height:"3em",marginLeft:(100-r)/2+"%"}),t.addElementToParentElement(n,o)}function l(){for(var e,o,r=0,a=0,i=n(),l=i.length,d=0;l>d;d++)o=t.getHTMLElementBasedOnItsId("cloud-row"+r),e=t.createAHTMLElement("div",d,["word","text-size-"+u(i[d].volume||10),s(i[d].sentimentScore||50)]),e.innerHTML=i[d].label||"",t.applyStylingToAHTMLElement(e,{marginTop:Math.floor(Math.random()*f.aMaxFactorForMarginLeftAndRight)+"px",marginBottom:Math.floor(Math.random()*f.aMaxFactorForMarginLeftAndRight)+"px",marginLeft:Math.floor(Math.random()*f.aMaxFactorForMarginTopAndBottom)+"px",marginRight:Math.floor(Math.random()*f.aMaxFactorForMarginTopAndBottom)+"px"}),o.appendChild(e),a+=e.offsetWidth+parseInt(e.style.marginLeft)+parseInt(e.style.marginRight),o.offsetWidth<a&&(o.removeChild(e),a=0,r++,d--)}function d(){for(var e=t.getHTMLElementsBasedOnTheirClass("word"),o=new wordCloud.MetaData,n=0;n<e.length;n++)e[n].addEventListener("click",o.updateMetaInformation.bind(o),!1)}function u(e){if(0>e||"number"!=typeof e)throw Error("Plese provide a valid value.");var t=1;return e>=0&&5>=e||(t=e>5&&15>=e?2:e>15&&25>=e?3:e>25&&50>=e?4:e>50&&100>=e?5:6),t}function s(e){if("number"!=typeof e)throw new Error("The score has to be a number.");var t="";return t=40>e?"red":e>60?"green":"gray"}var c=[],f={aMaxFactorForMarginLeftAndRight:15,aMaxFactorForMarginTopAndBottom:40};return{getTopics:n,setTopics:r,createARandomCloud:i,addWordsInsideTheCloud:l,doWordCloudAfterReceivedRespone:a,getTextSizeBasedOnPopularity:u,getColorBasedOnSentimentScore:s}}(wordCloud.mathModule,wordCloud.uiHelpersModule,wordCloud.MetaData);wordCloud.MetaData = (function(TwoWayBind, wordCloudModule, uiHelpersModule) {       
        function MetaData() {
            this.label = new TwoWayBind(this, "label");
            this.volume = new TwoWayBind(this, "volume");
            this.positive = new TwoWayBind(this, "positive");
            this.neutral = new TwoWayBind(this, "neutral");
            this.negative = new TwoWayBind(this, "negative");
        }
        
        MetaData.prototype.updateMetaInformation  = function(e) {
            var key = e.currentTarget.id;
            var result = wordCloudModule.getTopics()[key];
            
            if (!uiHelpersModule.checkIfAHTMLElementHasASpecificStyle("metadata", "display", "none")) {
                uiHelpersModule.setStyleInAHTMLElement("metadata", "display", "block");
                uiHelpersModule.setStyleInAHTMLElement("start-info", "display", "none");                 
            }

            this.label = result.label || "";
            this.volume = result.volume || 0;
            this.positive = result.sentiment.positive || 0;
            this.neutral = result.sentiment.neutral || 0;
            this.negative = result.sentiment.negative || 0;
        }
        
        return MetaData;
})(wordCloud.TwoWayBind, wordCloud.wordCloudModule, wordCloud.uiHelpersModule);
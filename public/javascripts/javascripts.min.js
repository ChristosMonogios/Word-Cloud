var wordCloud={};wordCloud.communicationModule=function(){function t(t,e){n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t instanceof Function?t(JSON.parse(n.responseText)):console.log("do nothing with the results."):e())},n.open("GET","/topics",!0),n.send()}function e(){alert("An error happend while loading the results.")}var n=new XMLHttpRequest;return{get:t,defaultOnErrorAction:e}}(),wordCloud.Binder=function(){function t(t){this.objectCallbacks={},e=t,n=this,document.addEventListener("change",this.callbackOnChangeEvent.bind(e),!1)}var e=null,n=null;return t.prototype.subscribe=function(t,e){this.objectCallbacks[t]=this.objectCallbacks[t]||[],this.objectCallbacks[t].push(e)},t.prototype.publish=function(t,e,n){for(var o=this.objectCallbacks[e].length,r=0;o>r;r++)this.objectCallbacks[e][r](t,e,n)},t.prototype.callbackOnChangeEvent=function(t){var e=t.target,o=e.getAttribute("data-binding"),r=o.match(/[a-zA-Z0-9]+/g);o&&n.publish(this,r[1],e.value)},t}(),wordCloud.TwoWayBind=function(t){function e(n,o,r){var a=new t(n);Object.defineProperty(n,o,{get:function(){return n["_"+o]},set:function(t){t instanceof e||(n["_"+o]=t,a.publish(n,o,t))}}),a.subscribe(o,this.UIToModel),a.subscribe(o,this.defaultUiCallback)}return e.prototype.UIToModel=function(t,e,n){for(var o=document.querySelectorAll("[data-binding="+t.constructor.name+"-"+e+"]"),r=null,a=0;a<o.length;a++)r=o[a].tagName.toLowerCase(),"input"===r||"textarea"===r||"select"===r?o[a].value=n:o[a].innerHTML=n},e.prototype.defaultUiCallback=function(t,e,n){t["_"+e]=n},e}(wordCloud.Binder),window.onerror=function(t,e,n,o,r){uiHelpersModule.getHTMLElementBasedOnItsId("alert-area");alert(t)},wordCloud.ExceptionHandling=function(){return{}}(),wordCloud.resultTopics=[],console.log("test"),window.onload=function(){wordCloud.communicationModule.get(wordCloud.wordCloudModule.doWordCloudAfterReceivedRespone,wordCloud.communicationModule.defaultOnErrorAction)},wordCloud.mathModule=function(){function t(t,e){return"string"==typeof o?e[o]-t[o]:e-t}function e(e,n){if(!(e instanceof Array))return alert("provide an array"),[];var r=[];return o=n,e.sort(t),o=null,e.forEach(function(t,e){e%2?r.push(t):r.unshift(t)}),r}function n(t){function e(){return Math.random()-Math.random()}for(var n=[],o=0;20>=o;o++)n[o]=0;for(var o=0;t>o;o++)n[10+Math.round(10*e())]++;return n.slice(5,15)}var o=null;return{normalDistributionSorter:e,generateArrayWithNormalDistributedElements:n}}(),wordCloud.uiHelpersModule=function(){function t(t,e,n){var o=document.createElement(t);return o.id=e,o.classList.add(n),o}function e(t){return document.getElementById(t)}function n(t){return document.getElementsByClassName(t)}function o(t,e){for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])}function r(t,e){e.appendChild(t)}return{createAHTMLElement:t,getHTMLElementBasedOnItsId:e,getHTMLElementsBasedOnTheirClass:n,applyStylingToAHTMLElement:o,addElementToParentElement:r}}(),wordCloud.wordCloudModule=function(t,e,n){function o(){return c}function r(e){c=t.normalDistributionSorter(e,"volume")}function a(t){l(e.getHTMLElementBasedOnItsId("wordCloud")),r(t),i(),d()}function l(n){for(var o=null,r=0,a=n.offsetWidth,l=t.generateArrayWithNormalDistributedElements(10*a),i=l.length,d=0;i>d;d++)r=l[d],o=e.createAHTMLElement("div","cloudRow"+d,"cloudRow"),r=r/n.offsetWidth*100,e.applyStylingToAHTMLElement(o,{width:r+"%",height:"3em",marginLeft:(100-r)/2+"%"}),e.addElementToParentElement(o,n)}function i(){for(var t,n,r=0,a=0,l=o(),i=l.length,d=0;i>d;d++)n=e.getHTMLElementBasedOnItsId("cloudRow"+r),t=e.createAHTMLElement("div",d,"word"),t.classList.add("text-size-"+u(l[d].volume||10)),t.classList.add(s(l[d].sentimentScore||50)),t.innerHTML=l[d].label||"",t.name="word",e.applyStylingToAHTMLElement(t,{marginTop:Math.floor(10*Math.random())+"px",marginBottom:Math.floor(10*Math.random())+"px",marginLeft:Math.floor(30*Math.random())+1+"px",marginRight:Math.floor(30*Math.random())+1+"px"}),n.appendChild(t),a+=t.offsetWidth+parseInt(t.style.marginLeft)+parseInt(t.style.marginRight),n.offsetWidth<a&&(n.removeChild(t),a=0,r++,d--)}function d(){for(var t=e.getHTMLElementsBasedOnTheirClass("word"),n=new wordCloud.MetaData,o=0;o<t.length;o++)t[o].addEventListener("click",n.updateMetaInformation.bind(n),!1)}function u(t){if(0>t)throw Error("Volume cannot be negative.");var e=1;return t>=0&&5>=t||(e=t>5&&15>=t?2:t>15&&25>=t?3:t>25&&50>=t?4:t>50&&100>=t?5:6),e}function s(t){var e="";return e=40>t?"red":t>60?"green":"gray"}var c=[];return{getTopics:o,setTopics:r,createARandomCloud:l,addWordsInsideTheCloud:i,doWordCloudAfterReceivedRespone:a}}(wordCloud.mathModule,wordCloud.uiHelpersModule,wordCloud.MetaData);
 wordCloud.MetaData = (function(TwoWayBind, wordCloudModule) {
        var _label = null;
        var _volume = null;
        var _positive = null;
        var _neutral = null;
        var _negative = null;
        
        function MetaData() {
            this.label = new TwoWayBind(this, "label", TwoWayBind.defaultUiCallBack);
            this.volume = new TwoWayBind(this, "volume", TwoWayBind.defaultUiCallBack);
            this.positive = new TwoWayBind(this, "positive", TwoWayBind.defaultUiCallBack);
            this.neutral = new TwoWayBind(this, "neutral", TwoWayBind.defaultUiCallBack);
            this.negative = new TwoWayBind(this, "negative", TwoWayBind.defaultUiCallBack);
        }
        
        MetaData.prototype.updateMetaInformation  = function(e) {
            var key = e.currentTarget.id;
            var result = wordCloudModule.getTopics()[key];

            this.label = result.label || "";
            this.volume = result.volume || 0;
            this.positive = result.sentiment.positive || 0;
            this.neutral = result.sentiment.neutral || 0;
            this.negative = result.sentiment.negative || 0;
        }
        
        return MetaData;
})(wordCloud.TwoWayBind, wordCloud.wordCloudModule);
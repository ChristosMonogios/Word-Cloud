var wordCloud={};wordCloud.communicationModule=function(){function e(e,t){n.onreadystatechange=function(){4==n.readyState&&(200==n.status?e instanceof Function?e(JSON.parse(n.responseText)):console.log("do nothing with the results."):t())},n.open("GET","/topics",!0),n.send()}function t(){alert("An error happend while loading the results.")}var n=new XMLHttpRequest;return{get:e,defaultOnErrorAction:t}}(),wordCloud.Binder=function(){function e(e){this.objectCallbacks={},t=e,n=this,document.addEventListener("change",this.callbackOnChangeEvent.bind(t),!1)}var t=null,n=null;return e.prototype.subscribe=function(e,t){this.objectCallbacks[e]=this.objectCallbacks[e]||[],this.objectCallbacks[e].push(t)},e.prototype.publish=function(e,t,n){for(var o=this.objectCallbacks[t].length,r=0;o>r;r++)this.objectCallbacks[t][r](e,t,n)},e.prototype.callbackOnChangeEvent=function(e){var t=e.target,o=t.getAttribute("data-binding"),r=o.match(/[a-zA-Z0-9]+/g);o&&n.publish(this,r[1],t.value)},e}(),wordCloud.TwoWayBind=function(e){function t(n,o,r){var a=new e(n);Object.defineProperty(n,o,{get:function(){return n["_"+o]},set:function(e){e instanceof t||(n["_"+o]=e,a.publish(n,o,e))}}),a.subscribe(o,this.UIToModel),a.subscribe(o,this.defaultUiCallback)}return t.prototype.UIToModel=function(e,t,n){for(var o=document.querySelectorAll("[data-binding="+e.constructor.name+"-"+t+"]"),r=null,a=0;a<o.length;a++)r=o[a].tagName.toLowerCase(),"input"===r||"textarea"===r||"select"===r?o[a].value=n:o[a].innerHTML=n},t.prototype.defaultUiCallback=function(e,t,n){e["_"+t]=n},t}(wordCloud.Binder),window.onerror=function(e,t,n,o,r){uiHelpersModule.getHTMLElementBasedOnItsId("alert-area");alert(e)},wordCloud.ExceptionHandling=function(){return{}}(),wordCloud.resultTopics=[],console.log("test"),window.onload=function(){wordCloud.communicationModule.get(wordCloud.wordCloudModule.doWordCloudAfterReceivedRespone,wordCloud.communicationModule.defaultOnErrorAction)},wordCloud.mathModule=function(){function e(e,t){return"string"==typeof o?t[o]-e[o]:t-e}function t(t,n){if(!(t instanceof Array))throw new Error("Please provide an array.");if(void 0!==n&&"string"!=typeof n)throw new Error("The property has to be a string");var r=[];return o=n,t.sort(e),r=t.slice(0),t.length=0,r.forEach(function(e,n){n%2?t.push(e):t.unshift(e)}),o=null,t}function n(e){function t(){return Math.random()-Math.random()}for(var n=[],o=20,r=0;o>=r;r++)n[r]=0;for(var r=0;e>r;r++)n[10+Math.round(10*t())]++;return n.slice(5,15)}var o=null;return{normalDistributionSorter:t,generateArrayWithNormalDistributedElements:n,numberSorterDescending:e}}(),wordCloud.uiHelpersModule=function(){function e(e,t,n){if("string"!=typeof e)throw new Error("The type has to be a string.");var o=document.createElement(e);if(o.id=t,n instanceof Array)for(var r=0;r<n.length;r++)o.classList.add(n[r]);else o.classList.add(n);return o}function t(e){return document.getElementById(e)}function n(e){return document.getElementsByClassName(e)}function o(e,t){if(!e||!e.nodeType)throw new Error("Please provide a valid HTML element");if("object"!=typeof t)throw new Error("Please provide valid CSS-styles");for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}function r(e,t){if(!(e&&e.nodeType&&t&&t.nodeType))throw new Error("Please provide valid HTML elements");t.appendChild(e)}return{createAHTMLElement:e,getHTMLElementBasedOnItsId:t,getHTMLElementsBasedOnTheirClass:n,applyStylingToAHTMLElement:o,addElementToParentElement:r}}(),wordCloud.wordCloudModule=function(e,t,n){function o(){return c}function r(t){c=e.normalDistributionSorter(t,"volume")}function a(e){i(t.getHTMLElementBasedOnItsId("wordCloud")),r(e),l(),d()}function i(n){for(var o=null,r=0,a=n.offsetWidth,i=e.generateArrayWithNormalDistributedElements(10*a),l=i.length,d=0;l>d;d++)r=i[d],o=t.createAHTMLElement("div","cloudRow"+d,"cloudRow"),r=r/n.offsetWidth*100,t.applyStylingToAHTMLElement(o,{width:r+"%",height:"3em",marginLeft:(100-r)/2+"%"}),t.addElementToParentElement(o,n)}function l(){for(var e,n,r=0,a=0,i=o(),l=i.length,d=0;l>d;d++)n=t.getHTMLElementBasedOnItsId("cloudRow"+r),e=t.createAHTMLElement("div",d,["word","text-size-"+u(i[d].volume||10),s(i[d].sentimentScore||50)]),e.innerHTML=i[d].label||"",t.applyStylingToAHTMLElement(e,{marginTop:Math.floor(Math.random()*f.aMaxFactorForMarginLeftAndRight)+"px",marginBottom:Math.floor(Math.random()*f.aMaxFactorForMarginLeftAndRight)+"px",marginLeft:Math.floor(Math.random()*f.aMaxFactorForMarginTopAndBottom)+"px",marginRight:Math.floor(Math.random()*f.aMaxFactorForMarginTopAndBottom)+"px"}),n.appendChild(e),a+=e.offsetWidth+parseInt(e.style.marginLeft)+parseInt(e.style.marginRight),n.offsetWidth<a&&(n.removeChild(e),a=0,r++,d--)}function d(){for(var e=t.getHTMLElementsBasedOnTheirClass("word"),n=new wordCloud.MetaData,o=0;o<e.length;o++)e[o].addEventListener("click",n.updateMetaInformation.bind(n),!1)}function u(e){if(0>e)throw Error("Volume cannot be negative.");var t=1;return e>=0&&5>=e||(t=e>5&&15>=e?2:e>15&&25>=e?3:e>25&&50>=e?4:e>50&&100>=e?5:6),t}function s(e){var t="";return t=40>e?"red":e>60?"green":"gray"}var c=[],f={aMaxFactorForMarginLeftAndRight:15,aMaxFactorForMarginTopAndBottom:40};return{getTopics:o,setTopics:r,createARandomCloud:i,addWordsInsideTheCloud:l,doWordCloudAfterReceivedRespone:a,getTextSizeBasedOnPopularity:u,getColorBasedOnSentimentScore:s}}(wordCloud.mathModule,wordCloud.uiHelpersModule,wordCloud.MetaData);
 wordCloud.MetaData = (function(TwoWayBind, wordCloudModule) {
        var _label = null;
        var _volume = null;
        var _positive = null;
        var _neutral = null;
        var _negative = null;
        
        function MetaData() {
            this.label = new TwoWayBind(this, "label", TwoWayBind.defaultUiCallBack);
            this.volume = new TwoWayBind(this, "volume", TwoWayBind.defaultUiCallBack);
            this.positive = new TwoWayBind(this, "positive", TwoWayBind.defaultUiCallBack);
            this.neutral = new TwoWayBind(this, "neutral", TwoWayBind.defaultUiCallBack);
            this.negative = new TwoWayBind(this, "negative", TwoWayBind.defaultUiCallBack);
        }
        
        MetaData.prototype.updateMetaInformation  = function(e) {
            var key = e.currentTarget.id;
            var result = wordCloudModule.getTopics()[key];
            
            e.currentTarget.style.textDecoration = "underline";

            this.label = result.label || "";
            this.volume = result.volume || 0;
            this.positive = result.sentiment.positive || 0;
            this.neutral = result.sentiment.neutral || 0;
            this.negative = result.sentiment.negative || 0;
        }
        
        return MetaData;
})(wordCloud.TwoWayBind, wordCloud.wordCloudModule);